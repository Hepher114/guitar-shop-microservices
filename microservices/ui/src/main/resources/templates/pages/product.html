<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title th:text="${product.name} + ' — GuitarShop'">Product — GuitarShop</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link rel="stylesheet" th:href="@{/css/guitarshop.css}"/>
</head>
<body>
<div th:replace="~{fragments/layout :: navbar}"></div>

<div class="container my-5">

  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="/">Home</a></li>
      <li class="breadcrumb-item">
        <a th:href="@{'/?category=' + ${product.category}}" th:text="${product.category}">Category</a>
      </li>
      <li class="breadcrumb-item active" th:text="${product.name}">Product</li>
    </ol>
  </nav>

  <!-- Empty state -->
  <div th:if="${product == null or product.isEmpty()}" class="text-center py-5">
    <i class="fas fa-guitar fa-4x text-muted mb-3"></i>
    <h3 class="text-muted">Product not found</h3>
    <a href="/" class="btn btn-warning mt-3">Back to Shop</a>
  </div>

  <!-- Product Detail -->
  <div th:unless="${product == null or product.isEmpty()}" class="row g-5">

    <!-- Image -->
    <div class="col-md-5">
      <div class="card border-0 shadow-sm">
        <img th:src="${product.image_url} ?: '/images/placeholder.svg'"
             th:alt="${product.name}"
             class="card-img-top rounded"
             style="height: 400px; object-fit: cover;"
             onerror="this.src='/images/placeholder.svg'"/>
      </div>
    </div>

    <!-- Info -->
    <div class="col-md-7">
      <p class="text-muted text-uppercase fw-semibold small mb-1" th:text="${product.brand}">Brand</p>
      <h1 class="fw-bold mb-2" th:text="${product.name}">Product Name</h1>

      <div class="mb-3">
        <span class="badge bg-secondary me-2" th:text="${product.category}">Category</span>
        <span th:if="${product.stock > 0}" class="badge bg-success">
          <i class="fas fa-check me-1"></i>In Stock (<span th:text="${product.stock}">0</span> available)
        </span>
        <span th:unless="${product.stock > 0}" class="badge bg-danger">
          <i class="fas fa-times me-1"></i>Out of Stock
        </span>
      </div>

      <h2 class="text-success fw-bold mb-4"
          th:text="'$' + ${#numbers.formatDecimal(product.price, 1, 2)}">$0.00</h2>

      <p class="lead text-muted mb-4" th:text="${product.description}">Description</p>

      <!-- Add to Cart -->
      <form th:if="${product.stock > 0}" action="/cart/add" method="post" class="mb-3">
        <input type="hidden" name="productId" th:value="${product.id}"/>
        <input type="hidden" name="name"      th:value="${product.name}"/>
        <input type="hidden" name="brand"     th:value="${product.brand}"/>
        <input type="hidden" name="price"     th:value="${product.price}"/>
        <input type="hidden" name="imageUrl"  th:value="${product.image_url}"/>

        <div class="d-flex align-items-center gap-3 mb-3">
          <label class="fw-semibold">Quantity:</label>
          <input type="number" name="quantity" value="1" min="1"
                 th:max="${product.stock}"
                 class="form-control" style="width: 80px"/>
        </div>

        <button type="submit" class="btn btn-warning btn-lg px-5">
          <i class="fas fa-cart-plus me-2"></i>Add to Cart
        </button>
      </form>

      <div th:unless="${product.stock > 0}" class="alert alert-warning">
        <i class="fas fa-bell me-2"></i>This item is currently out of stock.
      </div>

      <a href="/" class="btn btn-outline-secondary mt-2">
        <i class="fas fa-arrow-left me-2"></i>Continue Shopping
      </a>

      <!-- Product details table -->
      <div class="mt-5">
        <h5 class="fw-bold mb-3">Product Details</h5>
        <table class="table table-bordered table-sm">
          <tbody>
            <tr>
              <th class="table-light" style="width:35%">Brand</th>
              <td th:text="${product.brand}">Brand</td>
            </tr>
            <tr>
              <th class="table-light">Category</th>
              <td th:text="${product.category}">Category</td>
            </tr>
            <tr>
              <th class="table-light">SKU</th>
              <td th:text="'GS-' + ${product.id}">GS-001</td>
            </tr>
            <tr>
              <th class="table-light">Stock</th>
              <td th:text="${product.stock} + ' units'">0 units</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div th:replace="~{fragments/layout :: footer}"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>
